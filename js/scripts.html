<!-- js/scripts.html -->
<script>
  function initializeModal() {
    console.log('Initializing modal...');
    
    const nextButton = document.getElementById('nextButton');
    const backButton = document.getElementById('backButton');
    const finishButton = document.getElementById('finishButton');
  
    console.log('Buttons found:', {
      next: !!nextButton,
      back: !!backButton,
      finish: !!finishButton
    });
  
    function getFormData() {
      console.log('Collecting form data...');
      const formData = {};
      
      // Get environment selection
      const environment = document.querySelector('input[name="environment"]:checked');
      if (environment) {
        formData.environment = environment.value;
        console.log('Environment found:', environment.value);
      } else {
        console.log('No environment selected');
      }
      
      // Get API key
      const api_Key = document.getElementById('apiKey');
      if (api_Key && api_Key.value) {
        formData.api_Key = api_Key.value;
        console.log('API key found:', '***' + api_Key.value.slice(-4));
      } else {
        console.log('No API key found');
      }
      
      console.log('Form data collected:', formData);
      return formData;
    }
  
    if (nextButton) {
      nextButton.onclick = function() {
        console.log('Next button clicked');
        const formData = getFormData(); // Collects the data from form inputs
        console.log('Sending next navigation with data:', formData);
        
        google.script.run
          .withSuccessHandler(function(result) {
            console.log('Navigation success:', result);
          })
          .withFailureHandler(function(error) {
            console.error('Navigation error:', error);
          })
          .handleNavigation('next', formData);
      };
    }
    
    if (backButton) {
      backButton.onclick = function() {
        console.log('Back button clicked');
        const formData = getFormData();
        console.log('Sending back navigation with data:', formData);
        
        google.script.run
          .withSuccessHandler(function(result) {
            console.log('Navigation success:', result);
          })
          .withFailureHandler(function(error) {
            console.error('Navigation error:', error);
          })
          .handleNavigation('back', formData);
      };
    }
    
    if (finishButton) {
      finishButton.onclick = function() {
        console.log('Finish button clicked');
        const formData = getFormData();
        console.log('Sending finish navigation with data:', formData);
        
        google.script.run
          .withSuccessHandler(function(result) {
            console.log('Navigation success:', result);
            if (result.success) {
              google.script.host.close();
            }
          })
          .withFailureHandler(function(error) {
            console.error('Navigation error:', error);
          })
          .handleNavigation('finish', formData);
      };
    }
  }
  
  // Initialize when the page loads
  document.addEventListener('DOMContentLoaded', function() {
    console.log('DOM loaded, initializing modal...');
    initializeModal();
  });
  </script>