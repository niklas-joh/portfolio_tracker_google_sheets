<script>
  /**
   * Saves the API key along with the selected environment.
   * Validates the API key input before proceeding.
   */
  function saveApiKey() {
    const apiKey = document.getElementById('apiKey').value;
    const environment = document.getElementById('environment').value;
    if (apiKey) {
      google.script.run.withSuccessHandler(onSaveSuccess).withFailureHandler(onSaveFailure).saveApiKey(apiKey, environment);
    } else {
      document.getElementById('statusMessage').innerText = 'Please enter a valid API key.';
    }
  }

  /**
   * Handles successful API key save operation.
   * Updates the status message and shows a confirmation modal.
   */
  function onSaveSuccess() {
    document.getElementById('statusMessage').innerText = 'API Key saved successfully!';
    showConfirmationModal();
  }

  /**
   * Handles the failure response when saving the API key.
   * Displays an error message with the provided error details.
   *
   * @param {Object} error - The error object containing details of the failure.
   */
  function onSaveFailure(error) {
    document.getElementById('statusMessage').innerText = 'Failed to save API Key: ' + error.message;
  }

  /**
   * Toggles the state of the Save button based on the API key input field.
   * Enables the button only if a valid API key is entered.
   */
  function toggleSaveButton() {
    const apiKey = document.getElementById('apiKey').value;
    const saveButton = document.getElementById('saveButton');
    saveButton.disabled = !apiKey;
  }
  
  /**
   * Displays a confirmation modal when the API key is saved successfully.
   */
   function showConfirmationModal() {
    google.script.run.showCustomModal('Success', 'html/confirmation_modal.html');
  }
</script>